<!DOCTYPE html>
<html>
<head>
<title>Audio Waves Wallpaper with Blurred Background</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    width: 100vw;
    /* Укажи URL твоего изображения здесь */
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/640px-Image_created_with_a_mobile_phone.png'); /* ЗАМЕНИ НА СВОЙ URL ИЗОБРАЖЕНИЯ */
    background-size: cover;
    background-position: center;
    filter: blur(8px); /* Насколько сильно размыть */
    -webkit-filter: blur(8px);
  }

  .visualizer-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Чтобы не мешать кликам по рабочему столу */
  }

  .bar {
    position: absolute;
    /* Базовые размеры баров */
    background-color: rgba(255, 255, 255, 0.7); /* Цвет волн */
    transition: all 0.05s linear; /* Плавность анимации */
  }

  /* Стили для баров по разным сторонам */
  .bar.top, .bar.bottom {
    height: 4px; /* Базовая высота горизонтальных баров */
    width: 4px; /* Базовая ширина горизонтальных баров */
  }

  .bar.left, .bar.right {
    width: 4px; /* Базовая ширина вертикальных баров */
    height: 4px; /* Базовая высота вертикальных баров */
  }

  /* Позиционирование по сторонам */
  .bar.top { top: 0; transform-origin: top; }
  .bar.bottom { bottom: 0; transform-origin: bottom; }
  .bar.left { left: 0; transform-origin: left; }
  .bar.right { right: 0; transform-origin: right; }
</style>
</head>
<body>
  <div class="visualizer-container"></div>
  <audio id="audioPlayer" controls loop style="display:none;">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

<script>
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const audioElement = document.getElementById('audioPlayer');
  const source = audioCtx.createMediaElementSource(audioElement);
  const analyser = audioCtx.createAnalyser();

  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  analyser.fftSize = 256; // Количество частотных диапазонов
  const bufferLength = analyser.frequencyBinData.length; // Длина массива данных частот
  const dataArray = new Uint8Array(bufferLength); // Массив для хранения данных частот

  const visualizerContainer = document.querySelector('.visualizer-container');
  const barBaseThickness = 4; // Базовая толщина полос в пикселях

  let bars = []; // Массив для хранения DOM-элементов полос

  // Функция для создания баров по периметру
  function createBars() {
    visualizerContainer.innerHTML = ''; // Очищаем контейнер перед пересозданием
    bars = []; // Очищаем массив баров

    const screenWidth = window.innerWidth;
    const screenHeight = window.innerHeight;

    // Расчет количества баров для каждой стороны, чтобы они были примерно одной толщины
    const numHorizontalBars = Math.floor(screenWidth / barBaseThickness);
    // Для вертикальных баров вычитаем 2 (верхний и нижний углы), чтобы не дублировать
    const numVerticalBars = Math.floor(screenHeight / barBaseThickness) - 2;

    // Создаем бары для верхней и нижней сторон
    for (let i = 0; i < numHorizontalBars; i++) {
      // Top bar
      const barTop = document.createElement('div');
      barTop.classList.add('bar', 'top');
      barTop.style.left = `${(screenWidth / numHorizontalBars) * i}px`;
      barTop.style.width = `${screenWidth / numHorizontalBars}px`; // Ширина чтобы покрыть всю сторону
      bars.push(barTop);
      visualizerContainer.appendChild(barTop);

      // Bottom bar
      const barBottom = document.createElement('div');
      barBottom.classList.add('bar', 'bottom');
      barBottom.style.left = `${(screenWidth / numHorizontalBars) * i}px`;
      barBottom.style.width = `${screenWidth / numHorizontalBars}px`;
      bars.push(barBottom);
      visualizerContainer.appendChild(barBottom);
    }

    // Создаем бары для левой и правой сторон
    for (let i = 0; i < numVerticalBars; i++) {
      // Left bar
      const barLeft = document.createElement('div');
      barLeft.classList.add('bar', 'left');
      // Позиционируем, чтобы не перекрывать угловые бары
      barLeft.style.top = `${(screenHeight / (numVerticalBars + 2)) * (i + 1)}px`;
      barLeft.style.height = `${screenHeight / (numVerticalBars + 2)}px`; // Высота чтобы покрыть всю сторону
      bars.push(barLeft);
      visualizerContainer.appendChild(barLeft);

      // Right bar
      const barRight = document.createElement('div');
      barRight.classList.add('bar', 'right');
      barRight.style.top = `${(screenHeight / (numVerticalBars + 2)) * (i + 1)}px`;
      barRight.style.height = `${screenHeight / (numVerticalBars + 2)}px`;
      bars.push(barRight);
      visualizerContainer.appendChild(barRight);
    }
  }

  // Функция для анимации баров
  function animateBars() {
    requestAnimationFrame(animateBars); // Запрашиваем следующий кадр анимации

    if (!analyser || !dataArray) return; // Проверка, что аудио контекст инициализирован

    analyser.getByteFrequencyData(dataArray); // Получаем данные частот

    const totalBars = bars.length;
    for (let i = 0; i < totalBars; i++) {
      // Выбираем данные частот для текущего бара.
      // Используем остаток от деления на bufferLength, чтобы циклично использовать данные
      let dataIndex = Math.floor(i % bufferLength);
      let barAmplitude = dataArray[dataIndex]; // Амплитуда частоты (0-255)

      // Нормализуем амплитуду, чтобы она не была слишком большой или маленькой
      // `maxHeight` - максимальное отклонение от базовой толщины
      const maxHeight = 80; // Максимальная высота/ширина "волны"
      let waveMagnitude = (barAmplitude / 255) * maxHeight;
      waveMagnitude = Math.max(0, waveMagnitude - barBaseThickness); // Убедимся, что не уходит в минус

      // Применяем высоту/ширину в зависимости от стороны
      if (bars[i].classList.contains('top') || bars[i].classList.contains('bottom')) {
        // Для горизонтальных баров изменяем высоту
        bars[i].style.height = `${barBaseThickness + waveMagnitude}px`;
      } else {
        // Для вертикальных баров изменяем ширину
        bars[i].style.width = `${barBaseThickness + waveMagnitude}px`;
      }

      // Опционально: меняем цвет в зависимости от частоты/амплитуды
      // const hue = (barAmplitude / 255) * 120 + 200; // Оттенок от синего до фиолетового
      // bars[i].style.backgroundColor = `hsl(${hue}, 100%, 70%)`;
    }
  }

  // Запускаем воспроизведение аудио при загрузке.
  // Блокировка автовоспроизведения браузерами может потребовать взаимодействия пользователя.
  audioElement.play().catch(e => {
    console.warn("Audio auto-play blocked. Please click to play audio for visualizer to start.", e);
    // Если автовоспроизведение заблокировано, можно показать кнопку "Play"
    // (для Lively это не так важно, так как он обычно управляет аудио самостоятельно)
  });

  // Пересоздаем бары при изменении размера окна
  window.addEventListener('resize', createBars);

  // Инициализация при загрузке страницы
  createBars();
  animateBars();
</script>
</body>
</html>
